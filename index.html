<!DOCTYPE html>
<html>
<head>
  <!-- Add Sheetsu Web Client script to the head -->
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="style.css" rel="stylesheet" type="text/css">
<!-- Add meta tags for mobile and IE -->
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
</head>

<body>

<h2>Boston Aikikai</h2>
<p>All blames go to Đạt Huỳnh.</p>

<script>
	var server_query = "https://spreadsheets.google.com/feeds/cells/1wVsAgR1g-X-P-0st4Roa4gbqp09CAg77ya7mQgDjBCk/od6/public/basic?alt=json";
	
	var server_update = "https://script.google.com/macros/s/AKfycbyZZwOslPJvD4ZAb2PC69bCxeIL92JAyUZMx2denbkT3NdyVDo/exec";
	
	var opacity = 0.6;
	
	var datapath = "/data.csv";
	var mats = ["A", "A", "A", "A", "A", "A",
				"A", "A", "A", "A", "A", "A",
				"A", "A", "A", "A", "A", "A",
				"A", "A", "A", "A", "A", "A",
				"A", "A", "A", "A", "A", "A",
				"A", "A", "A", "A", "A", "A",
				"A", "A", "A", "A", "A", "A",
				"A", "A", "A", "A", "A", "A",
				"A", "A", "A", "A", "A", "A",
				"A", "A", "A", "A", "A", "A",
				"A", "A", "A"];
				
	var infos = ["", "", "", "", "", "",
				"", "", "", "", "", "",
				"", "", "", "", "", "",
				"", "", "", "", "", "",
				"", "", "", "", "", "",
				"", "", "", "", "", "",
				"", "", "", "", "", "",
				"", "", "", "", "", "",
				"", "", "", "", "", "",
				"", "", "", "", "", "",
				"", "", ""];
				
	var prices = [130, 130, 130, 130, 130, 130, 130, 130, 130, 130,
				  130, 135, 135, 135, 135, 130, 130, 130, 130, 130,
				  130, 125, 125, 125, 125, 125, 125, 125, 125, 125,
				  125, 125, 125, 125, 125, 125, 125, 125, 120, 120,
				  120, 120, 120, 120, 120, 120, 120, 120, 120, 120,
				  120, 110, 110, 110, 110, 110, 110, 100, 100, 100,
				  100, 100, 100
				];
	
	var colors = {
		100: "#aaffaa",
		110: "#55ddff",
		120: "#8080ff",
		125: "#dd55ff",
		130: "#ff9955",
		135: "#ffcc00"
	};
	
	var total = 0;
	
	function formatInfo(){
		var ret = "";
		for(var i =0; i<infos.length-1;++i){
			ret += infos[i]+"|";
		}
		ret+=infos[infos.length-1];
		return ret;
	}
	
	function loadData(){
		$.getJSON(server_query, function(data) {
			str_info = "";
			for(var i =0; i < data.feed.entry.length; ++i){
				str = data.feed.entry[i].content.$t;
				if(str.includes("|")){
					str_info=str;
				}
			}
			infos = str_info.split("|");
			colorCode();
			however_info();
		});
	}
	
	function however_info(){
		buttons = document.getElementsByTagName('button')
		for(var i = 0; i < buttons.length;++i){
			button = buttons[i];
			name = button.className;
			id = Number(name.split("_")[1])-1;
			
			tooltip = button.children[0];
			
			tooltip.style.opacity = 1;
			
			price = prices[id];
			
			content = "ID: "+(id+1).toString() + " - Value: $"+price.toString();
			
			if(infos[id]!=""){
				content = content+" - Sold to "+infos[id];
			}
			
			tooltip.textContent = content;
		}
	}
	
	function setColor(button,color){
		button.style.backgroundColor = color;
		button.style.color = color;
	}
	
	function successFunc(data){
		console.log(data);
	}
	
	function updateData(){
		var new_data = { 
            type: "mat",
            value: formatInfo()
        }; 
		
		json_data = JSON.stringify(new_data);
		
		var ret = $.ajax({
			url: server_update+"?type=mat&value="+formatInfo(),
			method: "GET",
			dataType: "json",
			success:
			function(data){
				console.log(data);
				loadData();
				alert("Thanks for your support :)");
			},
			 error: function(data) {
                console.log(data);
            }
		});
		
	}
	
	function colorCode(){
		buttons = document.getElementsByTagName('button')
		for(var i = 0; i < buttons.length;++i){
			button = buttons[i];
			name = button.className;
			id = Number(name.split("_")[1])-1;
			price = prices[id];
			setColor(button,colors[price]);
			
			if(infos[id] != ""){
				mats[id]="B";
				button.style.opacity = opacity;
				button.onclick = null;
			}
			
			//console.log(name,id,colors[price]);
		}
	}
	
	function compute_price(){
		var ret = 0;
		for (var i = 0; i < mats.length; i++) {
			if(mats[i]=="S"){
				ret += prices[i];
			}
		}
		return ret;
	}
	
    function onClick(btn) {
		name = btn.className;
		id = Number(name.split("_")[1])-1;
		price = prices[id];
		
		if(mats[id] == "A"){
			//btn.style.backgroundColor = "#F93822";
			//setColor(btn,"#F93822");
			btn.style.opacity = opacity;
			
			btn.style.color = "#2a2aff";
			
			mats[id] = "S";
		}
		else if (mats[id] == "S"){
			//btn.style.backgroundColor = "#b1d79d";
			//setColor(btn,colors[price]);
			btn.style.opacity = 1;
			btn.style.color=colors[price];
			mats[id] = "A";
		}
		total = compute_price();
		
		price_text = document.getElementById("total_price");
		price_text.textContent = "$"+total.toString()
        
    }
	
	function submit(){
		text_name = document.getElementsByName('name')[0];
		name = text_name.value;
		text_note = document.getElementsByName('note')[0];
		note = text_note.value;
		
		
		if(name.includes("|")){
			alert("Cannot contain special character: |");
			return;
		}
		
		for(var i = 0; i < buttons.length;++i){
			if (mats[i]=="S"){
				infos[i] = name+" ("+note+")";
			}
			//console.log(name,id,colors[price]);
		}
		
		updateData();
	}
</script>

<div class="container" id="mat_layout">

<img src="Mat_pattern1.png" alt="Mat_layout">

<button class="mat_1" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_2" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_3" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_4" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_5" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_6" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_7" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_8" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_9" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_10" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_11" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_25" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_26" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_27" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_28" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_29" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_30" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_39" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_40" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_22" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_23" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_24" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_52" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_41" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_42" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_43" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_44" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_45" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_53" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_54" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_55" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_56" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_61" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_62" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_63" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_58" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_59" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_60" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_51" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_50" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_49" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_48" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_34" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_35" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_36" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_37" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_38" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_16" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_17" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_18" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_19" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_20" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_21" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_57" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_47" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_46" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_33" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_32" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_31" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_12" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_13" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_14" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>

<button class="mat_15" onclick="onClick(this)">
Select
<span class="tooltiptext">Tooltip text</span>
</button>


</div>


<div class="buy_container">

<script>

</script>

<form>
	Name:<br>
	<input type="text" name="name" value="">

	<br>Note:<br>
	<textarea name="note" style="height: 50px;width: 200px;" rows="10" cols="35"></textarea>

	<br>
	<p>Total:</p>
	<p id="total_price">$0</p>    
	<br>
</form>
<!-- Set up a container element for the button -->
<div id="paypal-button-container"></div>

<!-- Include the PayPal JavaScript SDK -->
<script src="https://www.paypal.com/sdk/js?client-id=sb&currency=USD"></script>

<script>
	loadData();
	
	// Render the PayPal button into #paypal-button-container
	paypal.Buttons({

		// Set up the transaction
		createOrder: function(data, actions) {
			return actions.order.create({
				purchase_units: [{
					amount: {
						value: '0.01'
					}
				}]
			});
		},

		// Finalize the transaction
		onApprove: function(data, actions) {
			return actions.order.capture().then(function(details) {
				// Show a success message to the buyer
				alert('Transaction completed by ' + details.payer.name.given_name + '!');
			});
		}


	}).render('#paypal-button-container');
</script>



</div>




</body></html>